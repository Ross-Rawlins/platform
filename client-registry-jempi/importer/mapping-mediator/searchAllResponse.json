{
  "name": "Search Endpoint deterministic response",
  "endpoint": {
    "pattern": "/search-response",
    "method": "GET"
  },
  "transformation": {
    "output": "JSON"
  },
  "inputTransforms": {
    "operands": "($transform := function($v) {[query.family ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'familyName', 'value': query.family}},query.given ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'givenName', 'value': query.given}},query.gender ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'gender', 'value': query.gender}},query.birthDate ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'dob', 'value': query.birthDate}},query.address ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'city', 'value': query.address}},query.telecom ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'phoneNumber', 'value': query.telecom}},query.identifier ? {'operator': 'and', 'operand': {'fn': 'eq', 'name': 'phn', 'value': query.identifier.$replace('http://fhir.health.gov.lk/ips/identifier/phn|','')}}, {'operator': 'or', 'operand': {'fn': 'eq', 'name': 'nic', 'value': query.identifier.$replace('http://fhir.health.gov.lk/ips/identifier/nic|','')}}, {'operator': 'or', 'operand': {'fn': 'eq', 'name': 'scn', 'value': query.identifier.$replace('http://fhir.health.gov.lk/ips/identifier/scn|','')}}, {'operator': 'or', 'operand': {'fn': 'eq', 'name': 'ppn', 'value': query.identifier.$replace('http://fhir.health.gov.lk/ips/identifier/passport|','')}}, {'operator': 'or', 'operand': {'fn': 'eq', 'name': 'dl', 'value': query.identifier.$replace('http://fhir.health.gov.lk/ips/identifier/drivers|','')}}]};$transform(query))"
  },
  "inputMapping": {
    "transforms.operands": "operands",
    "transforms.operands[0].operand": "operand"
  },
  "requests": {
    "response": [
      {
        "id": "jempiSearchAllResponse",
        "forwardExistingRequestBody": true,
        "config": {
          "method": "post",
          "url": "http://jempi-api:50000/JeMPI/cr-find"
        }
      }
    ]
  }
}
