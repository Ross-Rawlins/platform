version: "3.9"

services:

  jempi-bootstrapper:
    image: jembi/jempi-bootstrapper:${JEMPI_BOOTSTRAPPER_IMAGE_TAG}
    configs:
      - target: /app/conf_system/config.json
        source: config.json
    environment:
      POSTGRESQL_IP: ${POSTGRES_SERVICE}
      POSTGRESQL_PORT: 5432
      POSTGRESQL_USER: ${JEMPI_POSTGRESQL_USERNAME}
      POSTGRESQL_PASSWORD: ${JEMPI_POSTGRESQL_PASSWORD}
      POSTGRESQL_DATABASE: ${POSTGRESQL_DATABASE}
      POSTGRESQL_USERS_DB: ${POSTGRESQL_USERS_DB}
      POSTGRESQL_NOTIFICATIONS_DB: ${POSTGRESQL_NOTIFICATIONS_DB}
      POSTGRESQL_AUDIT_DB: ${POSTGRESQL_AUDIT_DB}
      POSTGRESQL_KC_TEST_DB: ${POSTGRESQL_KC_TEST_DB}
      KAFKA_BOOTSTRAP_SERVERS: ${KAFKA_HOSTS}
      KAFKA_APPLICATION_ID: ${KAFKA_APPLICATION_ID_BOOTSTRAPPER}
      DGRAPH_HOSTS: ${DGRAPH_HOSTS}
      DGRAPH_PORTS: ${DGRAPH_PORTS}
    networks:
      kafka:
      default:
      jempi:
      postgres:

volumes:
  jempi-shared-data:

networks:
  kafka:
    name: kafka_public
    external: true
  default:
  jempi:
    name: jempi_public
    external: true
  postgres:
    name: postgres_public
    external: true

configs:
  config.json:
    file: ./config/config.json
    name: config.json-${config_json_DIGEST:?err}
    labels:
      name: jempi
